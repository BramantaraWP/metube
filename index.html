<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MeTube - No Ads, Pure Content</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üì∫</text></svg>">
    <style>
        /* ===== RESET & BASE STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, Arial, sans-serif;
        }

        body {
            background-color: #000;
            color: #fff;
            min-height: 100vh;
            transition: all 0.3s;
        }

        /* ===== BLACK & WHITE THEME ===== */
        .black-white-mode {
            filter: grayscale(100%) contrast(120%);
        }

        /* ===== NAVBAR ===== */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 24px;
            background-color: #111;
            border-bottom: 1px solid #333;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .menu-btn {
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .menu-btn:hover {
            background-color: #333;
        }

        .logo {
            font-size: 28px;
            font-weight: 900;
            letter-spacing: -1px;
        }

        .logo-black {
            color: #000;
            background-color: #fff;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .logo-white {
            color: #fff;
        }

        .search-bar {
            display: flex;
            flex: 0 1 600px;
            margin: 0 20px;
        }

        #searchInput {
            flex: 1;
            padding: 12px 20px;
            background-color: #222;
            border: 1px solid #333;
            border-right: none;
            color: white;
            font-size: 16px;
            border-radius: 40px 0 0 40px;
            outline: none;
        }

        #searchInput:focus {
            border-color: #555;
        }

        #searchBtn {
            padding: 12px 24px;
            background-color: #222;
            border: 1px solid #333;
            border-left: none;
            color: white;
            cursor: pointer;
            border-radius: 0 40px 40px 0;
            font-size: 18px;
            transition: background 0.2s;
        }

        #searchBtn:hover {
            background-color: #333;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        #myselfToggle {
            padding: 10px 20px;
            background: linear-gradient(45deg, #000, #333);
            color: white;
            border: 1px solid #555;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        #myselfToggle:hover {
            background: linear-gradient(45deg, #222, #444);
            transform: translateY(-2px);
        }

        #themeToggle {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background-color: #222;
            border: 1px solid #333;
            color: white;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        #themeToggle:hover {
            background-color: #333;
            transform: rotate(30deg);
        }

        /* ===== CONTAINER LAYOUT ===== */
        .container {
            display: flex;
            min-height: calc(100vh - 70px);
        }

        /* ===== SIDEBAR ===== */
        .sidebar {
            width: 240px;
            background-color: #111;
            padding: 20px 0;
            border-right: 1px solid #333;
            overflow-y: auto;
            transition: all 0.3s;
        }

        .sidebar-item {
            padding: 12px 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: background 0.2s;
        }

        .sidebar-item:hover {
            background-color: #222;
        }

        .sidebar-item.active {
            background-color: #333;
            border-left: 4px solid white;
        }

        .sidebar hr {
            border: none;
            border-top: 1px solid #333;
            margin: 20px 0;
        }

        .myself-panel {
            padding: 20px;
            background-color: #1a1a1a;
            border-radius: 12px;
            margin: 15px;
            border: 1px solid #333;
        }

        .myself-panel h4 {
            margin-bottom: 15px;
            color: #aaa;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .myself-panel div {
            margin-bottom: 10px;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
        }

        #resetProfile {
            width: 100%;
            padding: 10px;
            background-color: #333;
            color: white;
            border: 1px solid #555;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 10px;
            transition: background 0.2s;
        }

        #resetProfile:hover {
            background-color: #444;
        }

        /* ===== MAIN CONTENT ===== */
        .main-content {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
        }

        .welcome-section {
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(90deg, #111, #222);
            border-radius: 12px;
            border-left: 4px solid white;
        }

        .welcome-section h2 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .welcome-section p {
            color: #aaa;
            max-width: 800px;
        }

        .section-title {
            font-size: 22px;
            margin: 30px 0 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #333;
        }

        /* ===== VIDEO GRID ===== */
        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 24px;
            margin-top: 20px;
        }

        .video-card {
            background-color: #1a1a1a;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid #333;
        }

        .video-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            border-color: #555;
        }

        .thumbnail-container {
            position: relative;
            width: 100%;
            padding-top: 56.25%; /* 16:9 aspect ratio */
            overflow: hidden;
            background-color: #000;
        }

        .thumbnail {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-duration {
            position: absolute;
            bottom: 8px;
            right: 8px;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 3px 6px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .video-info {
            padding: 15px;
        }

        .video-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            line-height: 1.4;
        }

        .video-channel {
            color: #aaa;
            font-size: 14px;
            margin-bottom: 6px;
        }

        .video-meta {
            display: flex;
            justify-content: space-between;
            color: #888;
            font-size: 13px;
        }

        /* ===== VIDEO INFO MODAL ===== */
        .player-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .player-content {
            width: 100%;
            max-width: 800px;
            background-color: #111;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.7);
        }

        .close-player {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            z-index: 10;
            transition: background 0.2s;
        }

        .close-player:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }

        .video-preview {
            width: 100%;
            aspect-ratio: 16/9;
            background-color: #000;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 30px;
            text-align: center;
        }

        .video-preview img {
            max-width: 100%;
            max-height: 70%;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .watch-youtube-btn {
            padding: 15px 30px;
            background-color: #ff0000;
            color: white;
            border: none;
            border-radius: 30px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            text-decoration: none;
            margin-top: 20px;
        }

        .watch-youtube-btn:hover {
            background-color: #cc0000;
            transform: scale(1.05);
        }

        .player-info {
            padding: 25px;
            background-color: #151515;
        }

        .player-title {
            font-size: 24px;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .player-details {
            display: flex;
            justify-content: space-between;
            color: #aaa;
            margin-bottom: 25px;
            font-size: 14px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .player-description {
            color: #888;
            line-height: 1.6;
            margin-bottom: 25px;
            font-size: 15px;
        }

        .reaction-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .reaction {
            padding: 10px 20px;
            background-color: #222;
            color: white;
            border: 1px solid #444;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
            font-size: 14px;
        }

        .reaction:hover {
            background-color: #333;
            transform: scale(1.05);
        }

        .reaction.active {
            background-color: #444;
            border-color: #fff;
        }

        /* ===== LOADING INDICATOR ===== */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
            grid-column: 1 / -1;
        }

        .spinner {
            border: 4px solid #333;
            border-top: 4px solid white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ===== API STATUS ===== */
        .api-status {
            background-color: #1a1a1a;
            padding: 15px;
            border-radius: 8px;
            margin-top: 30px;
            border-left: 4px solid #555;
            font-size: 14px;
        }

        .api-status h4 {
            color: #aaa;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .api-status.online {
            border-left-color: #4CAF50;
        }

        .api-status.offline {
            border-left-color: #f44336;
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 1200px) {
            .video-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                padding: 10px 0;
                display: flex;
                overflow-x: auto;
                border-right: none;
                border-bottom: 1px solid #333;
            }
            
            .sidebar-item {
                padding: 10px 15px;
                white-space: nowrap;
            }
            
            .myself-panel {
                display: none;
            }
            
            .search-bar {
                flex: 1;
            }
            
            .navbar {
                padding: 10px 15px;
            }
            
            .player-modal {
                padding: 10px;
            }
            
            .reaction-buttons {
                flex-wrap: wrap;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .video-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-right {
                gap: 10px;
            }
            
            #myselfToggle {
                padding: 8px 12px;
                font-size: 14px;
            }
            
            .logo {
                font-size: 22px;
            }
            
            .player-info {
                padding: 15px;
            }
            
            .player-title {
                font-size: 18px;
            }
        }

        /* ===== MY SELF INDICATOR ===== */
        .myself-active {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #111;
            border: 2px solid #fff;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* ===== BADGES ===== */
        .video-badge {
            display: inline-block;
            padding: 3px 8px;
            background-color: #333;
            color: #fff;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
            margin-right: 5px;
            margin-bottom: 5px;
        }

        .badge-4k {
            background-color: #4CAF50;
        }

        .badge-hd {
            background-color: #2196F3;
        }

        .badge-new {
            background-color: #ff9800;
        }
    </style>
</head>
<body class="black-white-mode">
    <!-- NAVBAR -->
    <nav class="navbar">
        <div class="nav-left">
            <div class="menu-btn" id="menuBtn">‚ò∞</div>
            <div class="logo">
                <span class="logo-black">ME</span><span class="logo-white">TUBE</span>
            </div>
        </div>
        
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Search video tanpa iklan...">
            <button id="searchBtn">üîç</button>
        </div>
        
        <div class="nav-right">
            <button id="myselfToggle">MY SELF: OFF</button>
            <button id="themeToggle">üåì</button>
        </div>
    </nav>

    <!-- MAIN CONTAINER -->
    <div class="container">
        <!-- SIDEBAR -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-item active">üè† Beranda</div>
            <div class="sidebar-item">üî• Trending</div>
            <div class="sidebar-item">üì∫ Subscriptions</div>
            <div class="sidebar-item">‚è≥ History</div>
            <div class="sidebar-item">üíæ Watch Later</div>
            <div class="sidebar-item">‚ù§Ô∏è Liked Videos</div>
            <hr>
            <div class="myself-panel" id="myselfPanel">
                <h4>MY SELF PROFILE</h4>
                <div>Mood: <span id="userMood">Neutral</span></div>
                <div>Total Watch: <span id="watchTime">0h 0m</span></div>
                <div>Genre Favorit: <span id="preference">Loading...</span></div>
                <div>Searches: <span id="searchCount">0</span></div>
                <div>Skip Rate: <span id="skipRate">0%</span></div>
                <button id="resetProfile">Reset Profile</button>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="main-content">
            <div class="welcome-section">
                <h2>Selamat Datang di MeTube</h2>
                <p>YouTube tanpa iklan yang mempelajari preferensi Anda. Sistem "My Self" akan merekam interaksi Anda untuk menampilkan konten yang lebih relevan.</p>
                <p><strong>Note:</strong> Video akan dibuka di YouTube asli. Fokus utama adalah sistem rekomendasi My Self yang belajar dari interaksi Anda.</p>
            </div>
            
            <h3 class="section-title">Video Untuk Anda</h3>
            
            <!-- VIDEO GRID -->
            <div class="video-grid" id="videoGrid">
                <!-- Video cards akan dimuat di sini -->
            </div>
            
            <!-- LOADING INDICATOR -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Memuat video dari API...</p>
            </div>
            
            <!-- API STATUS -->
            <div class="api-status offline" id="apiStatus">
                <h4>‚öôÔ∏è API Status</h4>
                <p id="apiStatusText">Menghubungi API video...</p>
            </div>
        </main>
    </div>

    <!-- VIDEO INFO MODAL -->
    <div class="player-modal" id="playerModal">
        <div class="player-content">
            <button class="close-player" id="closePlayer">&times;</button>
            <div class="video-preview" id="videoPreview">
                <!-- Preview akan dimuat di sini -->
            </div>
            <div class="player-info">
                <h2 class="player-title" id="playerTitle">Judul Video</h2>
                <div class="player-details">
                    <span id="playerChannel">Channel</span>
                    <span id="playerViews">Views</span>
                    <span id="playerPublished">Published</span>
                    <span id="playerDuration">Duration</span>
                </div>
                <div class="player-description" id="playerDescription">
                    Deskripsi video akan muncul di sini...
                </div>
                <div class="reaction-buttons">
                    <button class="reaction" data-action="like">üëç Like</button>
                    <button class="reaction" data-action="skip">‚è≠Ô∏è Skip</button>
                    <button class="reaction" data-action="finish">‚úÖ Finish</button>
                    <button class="reaction" data-action="share">üîó Share</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MY SELF INDICATOR -->
    <div class="myself-active" id="myselfIndicator" style="display: none;">
        <span style="font-size: 24px;">üëÅÔ∏è</span>
    </div>

    <script>
        // ===== GLOBAL VARIABLES =====
        let myselfActive = false;
        let myselfProfile = null;
        let currentVideos = [];
        let currentPlayingVideo = null;
        let isAPIWorking = false;

        // ===== MY SELF SYSTEM =====
        class MyselfSystem {
            constructor() {
                this.loadProfile();
                this.initTracking();
            }

            loadProfile() {
                const saved = localStorage.getItem('metube_profile');
                if (saved) {
                    myselfProfile = JSON.parse(saved);
                    console.log('Profile loaded:', myselfProfile);
                } else {
                    myselfProfile = {
                        id: Date.now().toString(36),
                        created: new Date().toISOString(),
                        preferences: {
                            genres: {},
                            watchHistory: [],
                            reactionHistory: [],
                            searchHistory: [],
                            watchPatterns: {
                                averageWatchTime: 0,
                                preferredDuration: 'medium',
                                skipRate: 0,
                                peakHours: []
                            }
                        },
                        mood: 'neutral',
                        totalWatchSeconds: 0,
                        lastActive: new Date().toISOString()
                    };
                    this.saveProfile();
                }
                this.updateProfileDisplay();
            }

            saveProfile() {
                myselfProfile.lastActive = new Date().toISOString();
                localStorage.setItem('metube_profile', JSON.stringify(myselfProfile));
            }

            initTracking() {
                // Track mouse movements
                let mousePositions = [];
                document.addEventListener('mousemove', (e) => {
                    if (!myselfActive) return;
                    
                    mousePositions.push({ x: e.clientX, y: e.clientY, time: Date.now() });
                    
                    if (mousePositions.length > 50) {
                        mousePositions.shift();
                    }
                    
                    if (mousePositions.length >= 10) {
                        const recent = mousePositions.slice(-10);
                        const totalDistance = recent.reduce((sum, pos, i) => {
                            if (i === 0) return sum;
                            const prev = recent[i-1];
                            const distance = Math.sqrt(
                                Math.pow(pos.x - prev.x, 2) + Math.pow(pos.y - prev.y, 2)
                            );
                            return sum + distance;
                        }, 0);
                        
                        if (totalDistance > 5000) {
                            myselfProfile.mood = 'excited';
                        } else if (totalDistance < 1000) {
                            myselfProfile.mood = 'focused';
                        }
                    }
                });

                // Track scroll behavior
                let lastScrollTime = Date.now();
                window.addEventListener('scroll', () => {
                    if (!myselfActive) return;
                    
                    const now = Date.now();
                    const timeSinceLastScroll = now - lastScrollTime;
                    
                    if (timeSinceLastScroll < 200) {
                        myselfProfile.mood = 'impatient';
                    }
                    
                    lastScrollTime = now;
                });

                // Track video interactions
                document.addEventListener('click', (e) => {
                    if (!myselfActive) return;
                    
                    const target = e.target;
                    if (target.closest('.video-card')) {
                        this.recordInteraction('video_click');
                    }
                });
            }

            recordSearch(query) {
                if (!myselfActive || !query.trim()) return;
                
                myselfProfile.preferences.searchHistory.push({
                    query: query,
                    timestamp: new Date().toISOString()
                });
                
                if (myselfProfile.preferences.searchHistory.length > 20) {
                    myselfProfile.preferences.searchHistory.shift();
                }
                
                this.analyzeSearchPatterns();
                this.saveProfile();
                this.updateProfileDisplay();
            }

            recordVideoInteraction(videoId, action, metadata = {}) {
                if (!myselfActive) return;
                
                myselfProfile.preferences.reactionHistory.push({
                    videoId,
                    action,
                    timestamp: new Date().toISOString(),
                    ...metadata
                });
                
                // Update skip rate
                const totalReactions = myselfProfile.preferences.reactionHistory.length;
                const skips = myselfProfile.preferences.reactionHistory.filter(r => r.action === 'skip').length;
                myselfProfile.preferences.watchPatterns.skipRate = totalReactions > 0 ? (skips / totalReactions) * 100 : 0;
                
                // Update watch time
                if (action === 'finish' && metadata.duration) {
                    myselfProfile.totalWatchSeconds += metadata.duration;
                }
                
                // Add to watch history
                if (action === 'view') {
                    myselfProfile.preferences.watchHistory.push({
                        videoId,
                        title: metadata.title,
                        timestamp: new Date().toISOString(),
                        duration: metadata.duration
                    });
                    
                    if (myselfProfile.preferences.watchHistory.length > 50) {
                        myselfProfile.preferences.watchHistory.shift();
                    }
                }
                
                this.saveProfile();
                this.updateProfileDisplay();
            }

            analyzeSearchPatterns() {
                const searches = myselfProfile.preferences.searchHistory.map(s => s.query.toLowerCase());
                
                const genreKeywords = {
                    'gaming': ['game', 'gaming', 'playthrough', 'stream', 'esports'],
                    'music': ['music', 'song', 'mv', 'audio', 'lyrics'],
                    'education': ['tutorial', 'how to', 'learn', 'course', 'education'],
                    'sports': ['sport', 'football', 'basketball', 'match', 'highlights'],
                    'entertainment': ['funny', 'comedy', 'entertainment', 'vlog', 'prank'],
                    'technology': ['tech', 'programming', 'coding', 'computer', 'ai'],
                    'cooking': ['cook', 'recipe', 'food', 'culinary', 'baking']
                };
                
                const genreCounts = {};
                
                searches.forEach(search => {
                    for (const [genre, keywords] of Object.entries(genreKeywords)) {
                        if (keywords.some(keyword => search.includes(keyword))) {
                            genreCounts[genre] = (genreCounts[genre] || 0) + 1;
                        }
                    }
                });
                
                myselfProfile.preferences.genres = genreCounts;
            }

            updateProfileDisplay() {
                document.getElementById('userMood').textContent = myselfProfile.mood;
                
                const hours = Math.floor(myselfProfile.totalWatchSeconds / 3600);
                const minutes = Math.floor((myselfProfile.totalWatchSeconds % 3600) / 60);
                document.getElementById('watchTime').textContent = `${hours}h ${minutes}m`;
                
                const genres = myselfProfile.preferences.genres;
                let topGenre = 'Belum ada data';
                let maxCount = 0;
                
                for (const [genre, count] of Object.entries(genres)) {
                    if (count > maxCount) {
                        maxCount = count;
                        topGenre = genre;
                    }
                }
                
                document.getElementById('preference').textContent = topGenre;
                document.getElementById('searchCount').textContent = myselfProfile.preferences.searchHistory.length;
                document.getElementById('skipRate').textContent = `${myselfProfile.preferences.watchPatterns.skipRate.toFixed(1)}%`;
            }

            resetProfile() {
                if (confirm('Apakah Anda yakin ingin mereset profil My Self? Semua data preferensi akan dihapus.')) {
                    localStorage.removeItem('metube_profile');
                    myselfProfile = null;
                    this.loadProfile();
                    alert('Profil telah direset!');
                }
            }
        }

        // ===== VIDEO API HANDLER =====
        class VideoAPI {
            constructor() {
                this.baseURL = 'https://api-lb.ct.ws/?api=1&q=';
                this.testAPI();
            }

            async testAPI() {
                try {
                    const response = await fetch(`${this.baseURL}test`);
                    isAPIWorking = response.ok;
                    
                    const statusElement = document.getElementById('apiStatus');
                    const statusText = document.getElementById('apiStatusText');
                    
                    if (isAPIWorking) {
                        statusElement.className = 'api-status online';
                        statusText.textContent = 'API online - Mencari video dari sumber eksternal';
                    } else {
                        statusElement.className = 'api-status offline';
                        statusText.textContent = 'API offline - Menggunakan data demo';
                    }
                } catch (error) {
                    isAPIWorking = false;
                    document.getElementById('apiStatus').className = 'api-status offline';
                    document.getElementById('apiStatusText').textContent = 'API offline - Menggunakan data demo';
                }
            }

            async searchVideos(query) {
                document.getElementById('loading').style.display = 'block';
                
                // Try real API first
                if (isAPIWorking && query && query.length > 2) {
                    try {
                        const apiUrl = `${this.baseURL}${encodeURIComponent(query)}`;
                        const response = await fetch(apiUrl);
                        
                        if (response.ok) {
                            const data = await response.text();
                            document.getElementById('loading').style.display = 'none';
                            return this.parseAPIResponse(data, query);
                        }
                    } catch (error) {
                        console.log('API request failed, using fallback');
                    }
                }
                
                // Fallback to mock data
                await new Promise(resolve => setTimeout(resolve, 800));
                document.getElementById('loading').style.display = 'none';
                return this.getMockVideos(query);
            }

            parseAPIResponse(apiData, query) {
                try {
                    // Parse the JSON response
                    const parsed = JSON.parse(apiData);
                    const videos = [];
                    
                    // Process each video item
                    if (Array.isArray(parsed)) {
                        parsed.forEach(item => {
                            if (item.videoId && item.title) {
                                videos.push({
                                    videoId: item.videoId,
                                    title: this.cleanTitle(item.title),
                                    channel: item.channel || 'Unknown Channel',
                                    thumbnail: `https://i.ytimg.com/vi/${item.videoId}/hqdefault.jpg`,
                                    duration: this.extractDuration(item),
                                    views: this.extractViews(item),
                                    publishedTime: this.extractPublishedTime(item),
                                    badges: this.extractBadges(item),
                                    description: `Video tentang ${query}. Ditemukan melalui API MeTube.`
                                });
                            }
                        });
                    }
                    
                    return videos.length > 0 ? videos.slice(0, 12) : this.getMockVideos(query);
                    
                } catch (error) {
                    console.error('Error parsing API response:', error);
                    return this.getMockVideos(query);
                }
            }

            cleanTitle(title) {
                // Remove HTML entities and clean up title
                return title
                    .replace(/&quot;/g, '"')
                    .replace(/&#39;/g, "'")
                    .replace(/&amp;/g, '&')
                    .replace(/\[\s*Music\s*\]/gi, '')
                    .replace(/\[\s*Official Video\s*\]/gi, '')
                    .trim();
            }

            extractDuration(item) {
                // Extract duration from API response
                if (item.lengthText && item.lengthText.simpleText) {
                    return item.lengthText.simpleText;
                }
                return this.randomDuration();
            }

            extractViews(item) {
                if (item.viewCountText && item.viewCountText.simpleText) {
                    return item.viewCountText.simpleText;
                } else if (item.shortViewCountText && item.shortViewCountText.simpleText) {
                    return item.shortViewCountText.simpleText + ' views';
                }
                return this.formatViews(Math.floor(Math.random() * 10000000));
            }

            extractPublishedTime(item) {
                if (item.publishedTimeText && item.publishedTimeText.simpleText) {
                    return item.publishedTimeText.simpleText;
                }
                return this.randomTimeAgo();
            }

            extractBadges(item) {
                const badges = [];
                if (item.badges) {
                    item.badges.forEach(badge => {
                        if (badge.metadataBadgeRenderer && badge.metadataBadgeRenderer.label) {
                            badges.push({
                                text: badge.metadataBadgeRenderer.label,
                                type: badge.metadataBadgeRenderer.style.includes('4K') ? '4k' : 'hd'
                            });
                        }
                    });
                }
                return badges;
            }

            getMockVideos(query) {
                const mockVideos = [
                    {
                        videoId: 'dQw4w9WgXcQ',
                        title: 'Never Gonna Give You Up',
                        channel: 'Rick Astley',
                        thumbnail: 'https://i.ytimg.com/vi/dQw4w9WgXcQ/hqdefault.jpg',
                        duration: '3:32',
                        views: '1.4B views',
                        publishedTime: '13 years ago',
                        badges: [{ text: '4K', type: '4k' }],
                        description: 'Official music video for Rick Astley - Never Gonna Give You Up'
                    },
                    {
                        videoId: '9bZkp7q19f0',
                        title: 'GANGNAM STYLE',
                        channel: 'officialpsy',
                        thumbnail: 'https://i.ytimg.com/vi/9bZkp7q19f0/hqdefault.jpg',
                        duration: '4:13',
                        views: '4.7B views',
                        publishedTime: '11 years ago',
                        badges: [{ text: 'HD', type: 'hd' }],
                        description: 'PSY - GANGNAM STYLE (Í∞ïÎÇ®Ïä§ÌÉÄÏùº) M/V'
                    },
                    {
                        videoId: 'kJQP7kiw5Fk',
                        title: 'Despacito',
                        channel: 'Luis Fonsi',
                        thumbnail: 'https://i.ytimg.com/vi/kJQP7kiw5Fk/hqdefault.jpg',
                        duration: '4:41',
                        views: '8.1B views',
                        publishedTime: '7 years ago',
                        badges: [{ text: '4K', type: '4k' }],
                        description: 'Luis Fonsi - Despacito ft. Daddy Yankee'
                    }
                ];

                if (query) {
                    return mockVideos.filter(video => 
                        video.title.toLowerCase().includes(query.toLowerCase()) ||
                        video.channel.toLowerCase().includes(query.toLowerCase())
                    );
                }
                
                return mockVideos;
            }

            randomDuration() {
                const minutes = Math.floor(Math.random() * 45) + 1;
                const seconds = Math.floor(Math.random() * 60);
                return `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }

            formatViews(count) {
                if (count >= 1000000) {
                    return `${(count / 1000000).toFixed(1)}M views`;
                } else if (count >= 1000) {
                    return `${(count / 1000).toFixed(1)}K views`;
                }
                return `${count} views`;
            }

            randomTimeAgo() {
                const times = ['1 day ago', '1 week ago', '2 weeks ago', '1 month ago', 
                              '3 months ago', '6 months ago', '1 year ago', '2 years ago'];
                return times[Math.floor(Math.random() * times.length)];
            }
        }

        // ===== UI CONTROLLER =====
        class UIController {
            constructor() {
                this.videoAPI = new VideoAPI();
                this.myselfSystem = new MyselfSystem();
                this.initEventListeners();
                this.loadHomeVideos();
            }

            initEventListeners() {
                document.getElementById('searchBtn').addEventListener('click', () => this.handleSearch());
                document.getElementById('searchInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.handleSearch();
                });

                document.getElementById('themeToggle').addEventListener('click', () => {
                    document.body.classList.toggle('black-white-mode');
                });

                document.getElementById('myselfToggle').addEventListener('click', () => {
                    myselfActive = !myselfActive;
                    document.getElementById('myselfToggle').textContent = 
                        `MY SELF: ${myselfActive ? 'ON' : 'OFF'}`;
                    document.getElementById('myselfIndicator').style.display = 
                        myselfActive ? 'flex' : 'none';
                    
                    if (myselfActive) {
                        alert('My Self mode aktif! Sistem sekarang mempelajari preferensi Anda.');
                    }
                });

                document.getElementById('resetProfile').addEventListener('click', () => {
                    this.myselfSystem.resetProfile();
                });

                document.getElementById('closePlayer').addEventListener('click', () => {
                    document.getElementById('playerModal').style.display = 'none';
                });

                document.getElementById('playerModal').addEventListener('click', (e) => {
                    if (e.target.id === 'playerModal') {
                        document.getElementById('playerModal').style.display = 'none';
                    }
                });

                document.querySelectorAll('.reaction').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const action = e.target.dataset.action;
                        this.handleReaction(action);
                    });
                });

                document.querySelectorAll('.sidebar-item').forEach((item, index) => {
                    item.addEventListener('click', () => {
                        document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active'));
                        item.classList.add('active');
                        
                        if (index === 0) {
                            this.loadHomeVideos();
                        }
                    });
                });

                document.getElementById('menuBtn').addEventListener('click', () => {
                    const sidebar = document.getElementById('sidebar');
                    sidebar.style.display = sidebar.style.display === 'none' ? 'block' : 'none';
                });
            }

            async handleSearch() {
                const query = document.getElementById('searchInput').value.trim();
                if (!query) {
                    this.loadHomeVideos();
                    return;
                }
                
                if (myselfActive) {
                    this.myselfSystem.recordSearch(query);
                }
                
                const videos = await this.videoAPI.searchVideos(query);
                this.displayVideos(videos);
            }

            async loadHomeVideos() {
                const videos = await this.videoAPI.searchVideos('music');
                this.displayVideos(videos);
            }

            displayVideos(videos) {
                currentVideos = videos;
                const videoGrid = document.getElementById('videoGrid');
                videoGrid.innerHTML = '';
                
                if (videos.length === 0) {
                    videoGrid.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #aaa;">
                            <h3>üòî Tidak ada video ditemukan</h3>
                            <p>Coba kata kunci pencarian yang berbeda</p>
                        </div>
                    `;
                    return;
                }
                
                videos.forEach(video => {
                    const videoCard = this.createVideoCard(video);
                    videoGrid.appendChild(videoCard);
                });
            }

            createVideoCard(video) {
                const card = document.createElement('div');
                card.className = 'video-card';
                card.dataset.videoId = video.videoId;
                
                const badgesHTML = video.badges ? video.badges.map(badge => 
                    `<span class="video-badge badge-${badge.type}">${badge.text}</span>`
                ).join('') : '';
                
                card.innerHTML = `
                    <div class="thumbnail-container">
                        <img src="${video.thumbnail}" alt="${video.title}" class="thumbnail" onerror="this.src='https://picsum.photos/seed/${video.videoId}/320/180?grayscale'">
                        <div class="video-duration">${video.duration}</div>
                    </div>
                    <div class="video-info">
                        <h3 class="video-title">${video.title}</h3>
                        <div class="video-channel">${video.channel}</div>
                        <div class="video-meta">
                            <span>${video.views}</span>
                            <span>${video.publishedTime}</span>
                        </div>
                        ${badgesHTML ? `<div style="margin-top: 8px;">${badgesHTML}</div>` : ''}
                    </div>
                `;
                
                card.addEventListener('click', () => this.showVideoInfo(video));
                return card;
            }

            showVideoInfo(video) {
                currentPlayingVideo = video;
                
                document.getElementById('playerTitle').textContent = video.title;
                document.getElementById('playerChannel').textContent = video.channel;
                document.getElementById('playerViews').textContent = video.views;
                document.getElementById('playerPublished').textContent = video.publishedTime;
                document.getElementById('playerDuration').textContent = video.duration;
                document.getElementById('playerDescription').textContent = video.description || `Video "${video.title}" oleh ${video.channel}.`;
                
                // Create preview with YouTube link
                const preview = document.getElementById('videoPreview');
                preview.innerHTML = `
                    <img src="${video.thumbnail}" alt="${video.title}" style="max-width: 100%; max-height: 60%; border-radius: 8px;" onerror="this.src='https://picsum.photos/seed/${video.videoId}/800/450?grayscale'">
                    <p style="margin: 15px 0; color: #aaa;">Video akan dibuka di YouTube</p>
                    <a href="https://www.youtube.com/watch?v=${video.videoId}" target="_blank" class="watch-youtube-btn">
                        <span>‚ñ∂Ô∏è</span> Tonton di YouTube
                    </a>
                `;
                
                document.getElementById('playerModal').style.display = 'flex';
                
                // Record video view in My Self system
                if (myselfActive) {
                    const durationSeconds = this.parseDurationToSeconds(video.duration);
                    this.myselfSystem.recordVideoInteraction(video.videoId, 'view', {
                        title: video.title,
                        channel: video.channel,
                        duration: durationSeconds
                    });
                }
            }

            parseDurationToSeconds(duration) {
                const parts = duration.split(':');
                if (parts.length === 2) {
                    return parseInt(parts[0]) * 60 + parseInt(parts[1]);
                }
                return 0;
            }

            handleReaction(action) {
                if (!currentPlayingVideo) return;
                
                if (!myselfActive) {
                    alert('Aktifkan My Self mode terlebih dahulu untuk mereaksi video!');
                    return;
                }
                
                const videoId = currentPlayingVideo.videoId;
                const videoTitle = currentPlayingVideo.title;
                
                this.myselfSystem.recordVideoInteraction(videoId, action, {
                    title: videoTitle,
                    timestamp: new Date().toISOString()
                });
                
                // Highlight the clicked button
                document.querySelectorAll('.reaction').forEach(btn => btn.classList.remove('active'));
                event.target.classList.add('active');
                
                const messages = {
                    'like': 'Video disukai! Sistem akan merekomendasikan lebih banyak konten seperti ini.',
                    'skip': 'Video dilewati! Sistem akan mengurangi rekomendasi konten serupa.',
                    'finish': 'Video ditandai sebagai selesai ditonton!',
                    'share': 'Video dibagikan! (Simulasi)'
                };
                
                alert(messages[action]);
                
                // Close modal after skip or finish
                if (action === 'skip' || action === 'finish') {
                    setTimeout(() => {
                        document.getElementById('playerModal').style.display = 'none';
                        
                        // Load new recommendations after skipping
                        if (action === 'skip' && myselfActive) {
                            setTimeout(() => {
                                this.loadHomeVideos();
                            }, 500);
                        }
                    }, 1000);
                }
            }
        }

        // ===== INITIALIZE APP =====
        document.addEventListener('DOMContentLoaded', () => {
            const app = new UIController();
            
            // Welcome message
            setTimeout(() => {
                console.log(`
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë         üé¨ MeTube Siap Digunakan! üé¨             ‚ïë
‚ïë                                                  ‚ïë
‚ïë  APA YANG BERFUNGSI:                             ‚ïë
‚ïë  ‚Ä¢ Pencarian video dari API                      ‚ïë
‚ïë  ‚Ä¢ Sistem My Self (Tracking preferensi)         ‚ïë
‚ïë  ‚Ä¢ Black & White UI                             ‚ïë
‚ïë  ‚Ä¢ LocalStorage untuk profil pengguna           ‚ïë
‚ïë  ‚Ä¢ Link langsung ke YouTube                      ‚ïë
‚ïë                                                  ‚ïë
‚ïë  CARA PAKAI:                                     ‚ïë
‚ïë  1. Aktifkan "MY SELF"                           ‚ïë
‚ïë  2. Search video                                 ‚ïë
‚ïë  3. Klik video untuk lihat info                  ‚ïë
‚ïë  4. Klik "Tonton di YouTube"                     ‚ïë
‚ïë  5. Gunakan tombol reaksi                        ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
                `);
            }, 1000);
        });
    </script>
</body>
</html>
